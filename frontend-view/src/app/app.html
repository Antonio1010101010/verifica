<!-- Frontend View - Solo visualizzazione voti -->

<div class="container">
  <header class="header">
    <h1>{{ title() }}</h1>
    <p>Visualizzazione Voti</p>
  </header>

  <div class="search-section">
    <label for="studentFilter">Cerca per nome studente:</label>
    <input
      id="studentFilter"
      type="text"
      [(ngModel)]="studentNameFilter"
      (input)="onFilterChange()"
      placeholder="Inserisci il nome dello studente"
      class="search-input"
    />
  </div>

  <!-- Messaggio di errore -->
  <div *ngIf="errorMessage()" class="error-message">
    {{ errorMessage() }}
  </div>

  <!-- Caricamento -->
  <div *ngIf="isLoading()" class="loading">
    Caricamento voti...
  </div>

  <!-- Lista dei voti -->
  <div *ngIf="!isLoading()" class="grades-section">
    <div *ngIf="filteredGrades().length === 0" class="no-data">
      <p>
        {{ studentNameFilter() ? 'Nessun voto trovato per questo studente' : 'Nessun voto disponibile' }}
      </p>
    </div>

    <div *ngIf="filteredGrades().length > 0" class="grades-list">
      <h2>Elenco Voti</h2>
      <table class="grades-table">
        <thead>
          <tr>
            <th>Studente</th>
            <th>Materia</th>
            <th>Voto</th>
            <th>Data</th>
          </tr>
        </thead>
        <tbody>
          <tr
            *ngFor="let grade of filteredGrades()"
            [ngClass]="getGradeColor(grade.grade)"
            class="grade-row"
          >
            <td class="student-name">{{ grade.name }}</td>
            <td class="subject">{{ grade.subject }}</td>
            <td class="grade-value">{{ grade.grade }}</td>
            <td class="date">{{ formatDate(grade.grade_date) }}</td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Statistiche -->
    <div *ngIf="filteredGrades().length > 0" class="stats-section">
      <div class="stat-card">
        <h3>Totale Voti</h3>
        <p class="stat-number">{{ filteredGrades().length }}</p>
      </div>
      <div class="stat-card">
        <h3>Media Voti</h3>
        <p class="stat-number">
          {{ (filteredGrades().reduce((sum, g) => sum + g.grade, 0) / filteredGrades().length).toFixed(2) }}
        </p>
      </div>
      <div class="stat-card">
        <h3>Voti Insufficienti</h3>
        <p class="stat-number">{{ filteredGrades().filter(g => isFailingGrade(g.grade)).length }}</p>
      </div>
    </div>
  </div>
</div>
